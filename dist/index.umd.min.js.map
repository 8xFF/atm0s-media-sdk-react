{"version":3,"file":"index.umd.min.js","sources":["../src/hooks/device.ts","../src/components/provider.tsx","../src/hooks/state.ts","../src/hooks/consumer.ts","../src/hooks/publisher.ts","../src/components/video_viewer.tsx","../src/hooks/actions.ts","../src/hooks/audio_level.ts","../src/hooks/remote.ts","../src/hooks/session.ts"],"sourcesContent":["import { TypedEventEmitter } from '@8xff/atm0s-media-js/types/lib/utils/typed-event-emitter';\nimport { getLogger } from '@8xff/atm0s-media-js/types/lib/utils/logger';\nimport { useEffect, useState } from 'react';\n\nconst logger = getLogger('DeviceHook');\n\ninterface Return {\n  media?: MediaStream;\n  error?: Error;\n}\n\nclass StreamContainer extends TypedEventEmitter<{ changed: (data: Return) => void }> {\n  count = 0;\n  data: Return = {};\n\n  constructor(private key: string) {\n    super();\n    logger.log('Created container for local stream', key);\n  }\n\n  setData(data: Return) {\n    this.data = data;\n    this.emit('changed', data);\n  }\n\n  retain() {\n    this.count += 1;\n    logger.log('Retain local stream', this.key, this.count);\n    return this.count;\n  }\n\n  release() {\n    this.count -= 1;\n    logger.log('Release local stream', this.key, this.count);\n    if (this.count == 0) {\n      logger.log('Destroy local stream', this.key);\n      this.data.media?.getTracks().map((track) => {\n        track.stop();\n      });\n    }\n    return this.count;\n  }\n}\nconst globalStore: Map<string, StreamContainer> = new Map();\n\nexport const useDevices = (\n  kind: MediaDeviceKind,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): [MediaDeviceInfo[], any | null] => {\n  const [devices, setDevices] = useState<MediaDeviceInfo[]>([]);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    navigator.mediaDevices\n      .enumerateDevices()\n      .then((devices) => {\n        setDevices(devices.filter((d) => d.kind == kind));\n      })\n      .catch((error) => {\n        setDevices([]);\n        setError(error);\n      });\n  }, [kind]);\n\n  return [devices, error];\n};\n\nfunction getDevicePrivate(\n  kind: MediaDeviceKind,\n  deviceId: string | boolean,\n  callback: (data: Return) => void,\n): [StreamContainer, string] {\n  const key = kind + '-' + deviceId;\n  let containerSlot = globalStore.get(key);\n  if (containerSlot) {\n    containerSlot.on('changed', callback);\n    callback(containerSlot.data);\n  } else {\n    containerSlot = new StreamContainer(key);\n    globalStore.set(key, containerSlot);\n    let constraints: MediaStreamConstraints = {};\n    if (kind == 'audioinput') {\n      constraints = {\n        audio:\n          typeof deviceId == 'string'\n            ? {\n                deviceId: deviceId,\n              }\n            : true,\n      };\n    } else if (kind == 'videoinput') {\n      constraints = {\n        video:\n          typeof deviceId == 'string'\n            ? {\n                deviceId: deviceId,\n              }\n            : true,\n      };\n    }\n    navigator.mediaDevices\n      .getUserMedia(constraints)\n      .then((stream) => {\n        stream.cachedKey = key;\n        containerSlot?.setData({ media: stream });\n        callback({ media: stream });\n      })\n      .catch((err) => {\n        containerSlot?.setData({ error: err });\n        callback({ error: err });\n      });\n  }\n\n  return [containerSlot, key];\n}\n\nexport function getDevice(kind: MediaDeviceKind, deviceId: string | boolean): Promise<MediaStream> {\n  return new Promise((resolve, reject) => {\n    getDevicePrivate(kind, deviceId, (res) => {\n      if (res.error) {\n        reject(res.error);\n      } else {\n        resolve(res.media!);\n      }\n    });\n  });\n}\n\nexport function retainDevice(key: string) {\n  const slot = globalStore.get(key);\n  slot?.retain();\n}\n\nexport function releaseDevice(key: string) {\n  const slot = globalStore.get(key);\n  if (slot?.release() == 0) {\n    globalStore.delete(key);\n  }\n}\n\nexport const useDevice = (\n  kind: MediaDeviceKind,\n  deviceId: string | boolean,\n): [MediaStream | undefined, Error | undefined] => {\n  const [res, setRes] = useState({} as Return);\n  useEffect(() => {\n    if (deviceId != false) {\n      const [containerSlot, key] = getDevicePrivate(kind, deviceId, setRes);\n      containerSlot.retain();\n      return () => {\n        setRes({ media: undefined, error: undefined });\n        if (containerSlot?.release() == 0) {\n          globalStore.delete(key);\n        }\n      };\n    }\n  }, [kind, deviceId]);\n  return [res.media, res.error];\n};\n\nexport const useUserMedia = (\n  constraints?: MediaStreamConstraints,\n  active?: boolean,\n): [MediaStream | undefined, Error | undefined] => {\n  const [res, setRes] = useState({} as Return);\n  useEffect(() => {\n    if (active) {\n      let gotStream: MediaStream | undefined;\n      navigator.mediaDevices\n        .getUserMedia(constraints)\n        .then((stream) => {\n          gotStream = stream;\n          setRes({ media: stream });\n        })\n        .catch((err) => {\n          gotStream = undefined;\n          setRes({ error: err });\n        });\n      return () => {\n        setRes({ media: undefined, error: undefined });\n        gotStream?.getTracks().forEach((track) => {\n          track.stop();\n        });\n      };\n    }\n  }, [JSON.stringify(constraints), active]);\n  return [res.media, res.error];\n};\n\nexport const useDisplayMedia = (\n  constraints?: DisplayMediaStreamOptions,\n  active?: boolean,\n): [MediaStream | undefined, Error | undefined] => {\n  const [res, setRes] = useState({} as Return);\n  useEffect(() => {\n    if (active) {\n      let gotStream: MediaStream | undefined;\n      navigator.mediaDevices\n        .getDisplayMedia(constraints)\n        .then((stream) => {\n          gotStream = stream;\n          setRes({ media: stream });\n        })\n        .catch((err) => {\n          gotStream = undefined;\n          setRes({ error: err });\n        });\n      return () => {\n        setRes({ media: undefined, error: undefined });\n        gotStream?.getTracks().forEach((track) => {\n          track.stop();\n        });\n      };\n    }\n  }, [JSON.stringify(constraints), active]);\n  return [res.media, res.error];\n};\n","import React, { useCallback, useMemo, useState } from 'react';\nimport Atm0s, { type AnyFunction, type IPublisherCallbacks } from '@8xff/atm0s-media-js';\nimport { releaseDevice, retainDevice } from '../hooks/device';\n\nexport enum SessionState {\n  New = 'new',\n  Connecting = 'connecting',\n  Connected = 'connected',\n  Reconnecting = 'reconnecting',\n  Disconnected = 'disconnected',\n  Error = 'error',\n}\n\nexport class StreamPublisherWrap {\n  constructor(private publisher: Atm0s.StreamPublisher) {}\n\n  get state() {\n    return this.publisher.state;\n  }\n\n  get localStream() {\n    return this.publisher.localStream;\n  }\n\n  on(type: keyof IPublisherCallbacks, callback: AnyFunction) {\n    this.publisher.on(type, callback);\n  }\n\n  off(type: keyof IPublisherCallbacks, callback: AnyFunction) {\n    this.publisher.on(type, callback);\n  }\n\n  switchStream(stream: MediaStream | null) {\n    if (stream) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const cachedKey = stream.cachedKey;\n      if (cachedKey) {\n        retainDevice(cachedKey);\n      }\n    }\n    if (this.publisher.localStream) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const cacheKey = this.publisher.localStream.cachedKey;\n      if (cacheKey) {\n        releaseDevice(cacheKey);\n      }\n    }\n    return this.publisher.switch(stream);\n  }\n}\n\ninterface SessionContainer {\n  session: Atm0s.Session;\n  state: SessionState;\n  myAudioStreams: Atm0s.StreamRemote[];\n  myVideoStreams: Atm0s.StreamRemote[];\n  audioStreams: Atm0s.StreamRemote[];\n  videoStreams: Atm0s.StreamRemote[];\n  publishers: Map<string, ArcContainer<StreamPublisherWrap>>;\n  consumers: Map<string, ArcContainer<Atm0s.StreamConsumer>>;\n  consumerPairs: Map<string, ArcContainer<Atm0s.StreamConsumerPair>>;\n}\n\ninterface ArcContainer<T> {\n  data: T;\n  owners: Map<number, number>;\n}\n\ninterface SessionContextInfo {\n  data?: SessionContainer;\n  connect: (url: string, config: Atm0s.ISessionConfig) => void;\n  disconnect: () => void;\n  getPublisher(ownerId: number, cfg: Atm0s.SenderConfig): StreamPublisherWrap | undefined;\n  backPublisher(ownerId: number, cfg: Atm0s.SenderConfig): void;\n  getConsumer(ownerId: number, remote: Atm0s.StreamRemote): Atm0s.StreamConsumer | undefined;\n  backConsumer(owner_id: number, remote: Atm0s.StreamRemote): void;\n  getConsumerPair(\n    ownerId: number,\n    peerId: string,\n    audioName: string,\n    videoName: string,\n  ): Atm0s.StreamConsumerPair | undefined;\n  backConsumerPair(ownerId: number, peerId: string, audioName: string, videoName: string): void;\n  update: (new_info: SessionContainer) => void;\n}\n\nexport const SessionContext = React.createContext({} as SessionContextInfo);\n\ninterface Props {\n  children: React.ReactNode;\n  // log_level?: Atm0s.LogLevel;\n  url?: string;\n  config?: Atm0s.ISessionConfig;\n}\n\nlet GlobalVer = 0;\n\nexport const SessionProvider = (props: Props) => {\n  // if (props.log_level != undefined) {\n  //   Atm0s.setLogLevel(props.log_level);\n  // }\n  const [, setVer] = useState(0);\n  const storage = useMemo<{ data: SessionContainer | undefined }>(() => {\n    return { data: undefined };\n  }, []);\n  const update = useCallback(\n    (data: SessionContainer | undefined) => {\n      storage.data = data;\n      setVer(GlobalVer++);\n    },\n    [storage, setVer],\n  );\n  const connect = useCallback(\n    (url: string, config: Atm0s.ISessionConfig) => {\n      if (storage.data?.session) {\n        return () => {\n          storage.data?.session.disconnect();\n        };\n      }\n      const session = Atm0s.createSession(url, config);\n      const myAudioStreams = new Map<string, Atm0s.StreamRemote>();\n      const myVideoStreams = new Map<string, Atm0s.StreamRemote>();\n      const audioStreams = new Map<string, Atm0s.StreamRemote>();\n      const videoStreams = new Map<string, Atm0s.StreamRemote>();\n\n      const publishers: Map<string, ArcContainer<StreamPublisherWrap>> = new Map();\n      const consumers: Map<string, ArcContainer<Atm0s.StreamConsumer>> = new Map();\n      const consumerPairs: Map<string, ArcContainer<Atm0s.StreamConsumerPair>> = new Map();\n\n      config?.senders?.map((sender) => {\n        if (sender.stream) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const cachedKey = sender.stream.cachedKey;\n          if (cachedKey) {\n            retainDevice(cachedKey);\n          }\n        }\n      });\n\n      session.on('connected', () => {\n        if (storage.data?.session != session) return;\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('mystream_added', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          myAudioStreams.set(key, stream);\n        } else {\n          myVideoStreams.set(key, stream);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('mystream_updated', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          myAudioStreams.set(key, stream);\n        } else {\n          myVideoStreams.set(key, stream);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('mystream_removed', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          myAudioStreams.delete(key);\n        } else {\n          myVideoStreams.delete(key);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('stream_added', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          audioStreams.set(key, stream);\n        } else {\n          videoStreams.set(key, stream);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs: consumerPairs,\n        });\n      });\n\n      session.on('stream_updated', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          audioStreams.set(key, stream);\n        } else {\n          videoStreams.set(key, stream);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('stream_removed', (stream: Atm0s.StreamRemote) => {\n        if (storage.data?.session != session) return;\n        const key = stream.peerId + '-' + stream.name;\n        if (stream.kind === Atm0s.StreamKinds.AUDIO) {\n          audioStreams.delete(key);\n        } else {\n          videoStreams.delete(key);\n        }\n        update({\n          session,\n          state: SessionState.Connected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n\n      session.on('disconnected', () => {\n        if (storage.data?.session != session) return;\n        update({\n          session,\n          state: SessionState.Disconnected,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n      session.connect().catch((err) => {\n        if (storage.data?.session != session) return;\n        console.error(err);\n        update({\n          session,\n          state: SessionState.Error,\n          myAudioStreams: Array.from(myAudioStreams.values()),\n          myVideoStreams: Array.from(myVideoStreams.values()),\n          audioStreams: Array.from(audioStreams.values()),\n          videoStreams: Array.from(videoStreams.values()),\n          publishers,\n          consumers,\n          consumerPairs,\n        });\n      });\n      update({\n        session,\n        state: SessionState.Connecting,\n        myAudioStreams: [],\n        myVideoStreams: [],\n        audioStreams: [],\n        videoStreams: [],\n        publishers,\n        consumers,\n        consumerPairs,\n      });\n      return;\n    },\n    [storage, update],\n  );\n\n  const disconnect = useCallback(() => {\n    if (storage.data?.session) {\n      storage.data.session.disconnect();\n      update(undefined);\n    }\n  }, [storage, update]);\n\n  const getPublisher = useCallback(\n    (ownerId: number, cfg: Atm0s.SenderConfig) => {\n      const data = storage.data;\n      if (data?.session) {\n        let publisher = data.publishers.get(cfg.name);\n        if (!publisher) {\n          publisher = {\n            data: new StreamPublisherWrap(\n              data.session.createPublisher({\n                stream: cfg.stream,\n                name: cfg.name,\n                kind: cfg.kind,\n                preferredCodecs: cfg.preferredCodecs,\n                simulcast: cfg.simulcast,\n                maxBitrate: cfg.maxBitrate,\n                contentHint: cfg.contentHint,\n                screen: cfg.screen,\n              }),\n            ),\n            owners: new Map(),\n          };\n          data.publishers.set(cfg.name, publisher);\n        }\n        data.publishers.get(cfg.name)?.owners.set(ownerId, new Date().getTime());\n        return publisher.data;\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  const backPublisher = useCallback(\n    (ownerId: number, cfg: Atm0s.SenderConfig) => {\n      const data = storage.data;\n      if (data?.session) {\n        const publisher = data.publishers.get(cfg.name);\n        if (publisher) {\n          publisher.owners.delete(ownerId);\n          if (publisher.owners.size == 0) {\n            publisher.data.switchStream(null);\n            data.publishers.delete(cfg.name);\n          }\n        }\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  const getConsumer = useCallback(\n    (ownerId: number, stream: Atm0s.StreamRemote) => {\n      const data = storage.data;\n      if (data?.session) {\n        const key = stream.peerId + '-' + stream.name;\n        let consumer = data.consumers.get(key);\n        if (!consumer) {\n          consumer = {\n            data: data.session.createConsumer(stream),\n            owners: new Map(),\n          };\n          data.consumers.set(key, consumer);\n        }\n        data.consumers.get(key)?.owners.set(ownerId, new Date().getTime());\n        return consumer.data;\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  const backConsumer = useCallback(\n    (ownerId: number, stream: Atm0s.StreamRemote) => {\n      const data = storage.data;\n      if (data?.session) {\n        const key = stream.peerId + '-' + stream.name;\n        const consumer = data.consumers.get(key);\n        if (consumer) {\n          consumer.owners.delete(ownerId);\n          if (consumer.owners.size == 0) {\n            data.consumers.delete(key);\n          }\n        }\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  const getConsumerPair = useCallback(\n    (ownerId: number, peerId: string, audioName: string, videoName: string) => {\n      const data = storage.data;\n      if (data?.session) {\n        const key = peerId + '-' + audioName + '-' + videoName;\n        let consumer = data.consumerPairs.get(key);\n        if (!consumer) {\n          consumer = {\n            data: data.session.createConsumerPair(peerId, audioName, videoName),\n            owners: new Map(),\n          };\n          data.consumerPairs.set(key, consumer);\n        }\n        data.consumerPairs.get(key)?.owners.set(ownerId, new Date().getTime());\n        return consumer.data;\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  const backConsumerPair = useCallback(\n    (ownerId: number, peerId: string, audioName: string, videoName: string) => {\n      const data = storage.data;\n      if (data?.session) {\n        const key = peerId + '-' + audioName + '-' + videoName;\n        const consumer = data.consumerPairs.get(key);\n        if (consumer) {\n          consumer.owners.delete(ownerId);\n          if (consumer.owners.size == 0) {\n            data.consumerPairs.delete(key);\n          }\n        }\n      }\n      return undefined;\n    },\n    [storage],\n  );\n\n  React.useEffect(() => {\n    if (props.url && props.config) {\n      connect(props.url, props.config);\n      return () => {\n        disconnect();\n      };\n    }\n  }, [props.url, props.config, connect, disconnect]);\n\n  return (\n    <SessionContext.Provider\n      value={{\n        data: storage.data,\n        connect,\n        disconnect,\n        getPublisher: getPublisher,\n        backPublisher: backPublisher,\n        getConsumer: getConsumer,\n        backConsumer: backConsumer,\n        getConsumerPair: getConsumerPair,\n        backConsumerPair: backConsumerPair,\n        update,\n      }}>\n      {props.children}\n    </SessionContext.Provider>\n  );\n};\n","import { useContext } from 'react';\nimport { SessionContext, SessionState } from '../components/provider';\n\nexport const useSessionState = (): SessionState => {\n  const { data } = useContext(SessionContext);\n  return data?.state || SessionState.New;\n};\n","import { useContext, useEffect, useMemo, useState, type LegacyRef } from 'react';\nimport { SessionContext, SessionState } from '../components/provider';\nimport Atm0s from '@8xff/atm0s-media-js';\nimport { useSessionState } from './state';\n\nlet idSeed = 0;\nexport const useConsumer = (\n  remote?: Atm0s.StreamRemote,\n  priority?: number,\n  maxSpatial?: number,\n  maxTemporal?: number,\n): [LegacyRef<HTMLVideoElement> | undefined, Atm0s.StreamReceiverState, Atm0s.StreamConsumer | undefined] => {\n  const consumerId = useMemo(() => idSeed++, []);\n  const sessionState = useSessionState();\n  const [consumer, setConsumer] = useState<Atm0s.StreamConsumer>();\n  const [state, setState] = useState<Atm0s.StreamReceiverState>(Atm0s.StreamReceiverState.NoSource);\n  const [element, setElement] = useState<HTMLVideoElement>();\n  const { data, getConsumer, backConsumer } = useContext(SessionContext);\n\n  const isConnectionEstablished = [SessionState.Connected, SessionState.Reconnecting].indexOf(sessionState) >= 0;\n\n  useEffect(() => {\n    if (data?.session && remote) {\n      const consumer = getConsumer(consumerId, remote);\n      if (consumer) {\n        consumer.on('state', setState);\n        setState(consumer.state);\n        setConsumer(consumer);\n        return () => {\n          consumer?.unview('use-consumer-' + consumerId);\n          consumer?.off('state', setState);\n          backConsumer(consumerId, remote);\n        };\n      }\n    }\n  }, [data?.session, remote]);\n\n  useEffect(() => {\n    if (element && consumer && isConnectionEstablished) {\n      element.srcObject = consumer.view('use-consumer-' + consumerId, priority, maxSpatial, maxTemporal);\n      return () => {\n        element.srcObject = null;\n        consumer.unview('use-consumer-' + consumerId);\n      };\n    }\n  }, [element, consumer, isConnectionEstablished]);\n\n  useEffect(() => {\n    if (element && consumer && isConnectionEstablished) {\n      consumer.limit('use-consumer-' + consumerId, priority, maxSpatial, maxTemporal);\n    }\n  }, [element, consumer, isConnectionEstablished, priority, maxSpatial, maxTemporal]);\n\n  const ref = (instance: HTMLVideoElement | null) => {\n    setElement(instance || undefined);\n  };\n\n  return [ref, state, consumer];\n};\n\nexport const useConsumerPair = (\n  peerId: string,\n  audioName: string,\n  videoName: string,\n  priority?: number,\n  maxSpatial?: number,\n  maxTemporal?: number,\n): [LegacyRef<HTMLVideoElement> | undefined, Atm0s.StreamReceiverState, Atm0s.StreamConsumerPair | undefined] => {\n  const consumerId = useMemo(() => idSeed++, []);\n  const sessionState = useSessionState();\n  const [consumer, setConsumer] = useState<Atm0s.StreamConsumerPair>();\n  const [state, setState] = useState<Atm0s.StreamReceiverState>(Atm0s.StreamReceiverState.NoSource);\n  const [element, setElement] = useState<HTMLVideoElement>();\n  const { data, getConsumerPair: getConsumerPair, backConsumerPair: backConsumerPair } = useContext(SessionContext);\n\n  const isConnectionEstablished = [SessionState.Connected, SessionState.Reconnecting].indexOf(sessionState) >= 0;\n\n  useEffect(() => {\n    if (data?.session) {\n      const consumer = getConsumerPair(consumerId, peerId, audioName, videoName);\n      if (consumer) {\n        consumer.on('state', setState);\n        setState(consumer.state);\n        setConsumer(consumer);\n        return () => {\n          consumer?.off('state', setState);\n          backConsumerPair(consumerId, peerId, audioName, videoName);\n        };\n      }\n    }\n  }, [data?.session, peerId, audioName, videoName]);\n\n  useEffect(() => {\n    if (element && consumer && isConnectionEstablished) {\n      element.srcObject = consumer.view('use-consumer-' + consumerId, priority, maxSpatial, maxTemporal);\n      return () => {\n        element.srcObject = null;\n        consumer.unview('use-consumer-' + consumerId);\n      };\n    }\n  }, [element, consumer, isConnectionEstablished]);\n\n  useEffect(() => {\n    if (element && consumer && isConnectionEstablished) {\n      consumer.limit('use-consumer-' + consumerId, priority, maxSpatial, maxTemporal);\n    }\n  }, [element, consumer, isConnectionEstablished, priority, maxSpatial, maxTemporal]);\n\n  const ref = (instance: HTMLVideoElement | null) => {\n    setElement(instance || undefined);\n  };\n\n  return [ref, state, consumer];\n};\n\nexport const useLocalConsumer = (stream?: MediaStream) => {\n  const [element, setElement] = useState<HTMLVideoElement>();\n  useEffect(() => {\n    if (element && stream) {\n      element.srcObject = stream;\n      return () => {\n        element.srcObject = null;\n      };\n    }\n  }, [element, stream]);\n\n  return (instance: HTMLVideoElement | null) => {\n    setElement(instance || undefined);\n  };\n};\n","import { useContext, useEffect, useMemo, useState } from 'react';\nimport { SessionContext, StreamPublisherWrap } from '../components/provider';\nimport Atm0s from '@8xff/atm0s-media-js';\n\nlet idSeed = 0;\n\nexport const usePublisher = (\n  cfg: Atm0s.SenderConfig,\n): [Atm0s.StreamSenderState, MediaStream | undefined | null, StreamPublisherWrap | undefined] => {\n  const publisherId = useMemo(() => idSeed++, []);\n  const [state, setState] = useState<Atm0s.StreamSenderState>(Atm0s.StreamSenderState.Created);\n  const [producer, setProducer] = useState<StreamPublisherWrap>();\n  const { data, getPublisher: getPublisher, backPublisher: backPublisher } = useContext(SessionContext);\n  useEffect(() => {\n    if (data?.session) {\n      const newProducer = getPublisher(publisherId, cfg);\n      if (newProducer) {\n        const onUpdateState = (state: Atm0s.StreamSenderState) => {\n          setState(state);\n        };\n        newProducer.on('state', onUpdateState);\n        setProducer(newProducer);\n        setState(newProducer.state);\n        return () => {\n          newProducer?.off('state', onUpdateState);\n          backPublisher(publisherId, cfg);\n        };\n      }\n    }\n  }, [data?.session, cfg.kind + cfg.name]);\n\n  return [state, producer?.localStream, producer];\n};\n","import { StreamRemote } from '@8xff/atm0s-media-js';\nimport React from 'react';\nimport { useConsumer, useLocalConsumer } from '../hooks';\n\nexport const RemoteViewer = (props: { remote: StreamRemote; priority?: number }) => {\n  const [ref, state] = useConsumer(props.remote, props.priority);\n  return (\n    <div className=\"w-full h-full\">\n      <div>{state}</div>\n      <video muted autoPlay className=\"w-full h-full\" ref={ref}></video>\n    </div>\n  );\n};\n\nexport const LocalViewer = (props: { stream: MediaStream }) => {\n  const ref = useLocalConsumer(props.stream);\n  return <video muted autoPlay className=\"w-full h-full\" ref={ref}></video>;\n};\n\nexport const VideoViewer = (props: { stream: MediaStream | StreamRemote; priority?: number }) => {\n  if (props.stream instanceof StreamRemote) {\n    return <RemoteViewer remote={props.stream} priority={props.priority}></RemoteViewer>;\n  } else {\n    return <LocalViewer stream={props.stream}></LocalViewer>;\n  }\n};\n","import { useContext } from 'react';\nimport { SessionContext } from '../components/provider';\nimport type { ISessionConfig } from '@8xff/atm0s-media-js';\n\ninterface Actions {\n  connect: (url: string, config: ISessionConfig) => void;\n  disconnect: () => void;\n  playAudioMix: () => void;\n}\n\nexport const useActions = (): Actions => {\n  const { connect, disconnect } = useContext(SessionContext);\n  return {\n    connect,\n    disconnect,\n    playAudioMix: () => {\n      // data?.session.getMixMinusAudio()?.play();\n    },\n  };\n};\n","import { useContext, useEffect, useState } from 'react';\nimport * as Bluesea from '@8xff/atm0s-media-js';\nimport { StreamPublisherWrap, BlueseaSessionContext } from '../components';\n\nexport const useAudioLevelConsumer = (\n  consumer?: Bluesea.StreamConsumer | Bluesea.StreamConsumerPair,\n): number | undefined => {\n  const [audioLevel, setAudioLevel] = useState<number | undefined>(undefined);\n  useEffect(() => {\n    if (consumer) {\n      const handler = (level: number) => {\n        setAudioLevel(level);\n      };\n      consumer.on('audio_level', handler);\n\n      return () => {\n        consumer.off('audio_level', handler);\n      };\n    } else {\n      setAudioLevel(undefined);\n    }\n  }, [consumer]);\n  return audioLevel;\n};\n\nexport const useAudioLevelProducer = (producer?: StreamPublisherWrap): number | undefined => {\n  const [audioLevel, setAudioLevel] = useState<number | undefined>(undefined);\n  useEffect(() => {\n    if (producer) {\n      const handler = (level: number) => {\n        setAudioLevel(level);\n      };\n      producer.on('audio_level', handler);\n\n      return () => {\n        producer.off('audio_level', handler);\n      };\n    } else {\n      setAudioLevel(undefined);\n    }\n  }, [producer]);\n  return audioLevel;\n};\n\nexport interface AudioMixSlotInfo {\n  peerId: string;\n  streamName: string;\n  audioLevel: number;\n}\n\nexport const useAudioSlotMix = (slotIndex: number) => {\n  const [slot, setSlot] = useState<AudioMixSlotInfo | undefined>(undefined);\n  const { data } = useContext(BlueseaSessionContext);\n  useEffect(() => {\n    const mixMinus = data?.session.getMixMinusAudio();\n    if (mixMinus) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const handler = (info: any | null) => {\n        if (info) {\n          const sourceId = info[0].split(':');\n          setSlot({\n            peerId: sourceId[0],\n            streamName: sourceId[1],\n            audioLevel: info[1],\n          });\n        } else {\n          setSlot(undefined);\n        }\n      };\n      mixMinus.on(`slot_${slotIndex}`, handler);\n\n      return () => {\n        mixMinus?.off(`slot_${slotIndex}`, handler);\n      };\n    }\n  }, [slotIndex, data?.session.getMixMinusAudio()]);\n  return slot;\n};\n\nexport const useAudioLevelMix = (peerId: string, streamName: string) => {\n  const [audioLevel, setAudioLevel] = useState<number | undefined>(undefined);\n  const { data } = useContext(BlueseaSessionContext);\n  useEffect(() => {\n    const mixMinus = data?.session.getMixMinusAudio();\n    if (mixMinus) {\n      const handler = (level: number | null) => {\n        setAudioLevel(level || undefined);\n      };\n      mixMinus.on(`source_${peerId}:${streamName}`, handler);\n\n      return () => {\n        mixMinus?.off(`source_${peerId}:${streamName}`, handler);\n      };\n    }\n  }, [peerId, streamName, data?.session.getMixMinusAudio()]);\n  return audioLevel;\n};\n","import { useContext } from 'react';\nimport { SessionContext } from '../components/provider';\nimport Atm0s from '@8xff/atm0s-media-js';\n\nexport const useRemoteStreams = (kind: Atm0s.StreamKinds, isMine?: boolean): Atm0s.StreamRemote[] => {\n  const { data } = useContext(SessionContext);\n  if (kind == Atm0s.StreamKinds.AUDIO) {\n    if (isMine === true) {\n      return data?.myAudioStreams || [];\n    } else {\n      return data?.audioStreams || [];\n    }\n  } else {\n    if (isMine === true) {\n      return data?.myVideoStreams || [];\n    } else {\n      return data?.videoStreams || [];\n    }\n  }\n};\n\nexport const usePeerRemoteStreams = (peerId: string, kind: Atm0s.StreamKinds): Atm0s.StreamRemote[] => {\n  const { data } = useContext(SessionContext);\n  if (kind == Atm0s.StreamKinds.AUDIO) {\n    return data?.audioStreams.filter((a) => a.peerId === peerId) || [];\n  } else {\n    return data?.videoStreams.filter((a) => a.peerId === peerId) || [];\n  }\n};\n","import { useContext } from 'react';\nimport { SessionContext } from '../components/provider';\nimport Atm0s from '@8xff/atm0s-media-js';\n\nexport const useSession = (): Atm0s.Session | undefined => {\n  const { data } = useContext(SessionContext);\n  return data?.session;\n};\n"],"names":["logger","getLogger","StreamContainer","_super","key","_this","this","count","data","log","__extends","prototype","setData","emit","retain","release","_a","media","getTracks","map","track","stop","TypedEventEmitter","globalStore","Map","getDevicePrivate","kind","deviceId","callback","containerSlot","get","on","set","constraints","audio","video","navigator","mediaDevices","getUserMedia","then","stream","cachedKey","catch","err","error","retainDevice","slot","SessionState","exports","StreamPublisherWrap","publisher","Object","defineProperty","state","localStream","type","off","switchStream","cacheKey","delete","switch","SessionContext","React","createContext","GlobalVer","useSessionState","useContext","New","idSeed","useConsumer","remote","priority","maxSpatial","maxTemporal","consumerId","useMemo","sessionState","useState","consumer","setConsumer","_b","Atm0s","StreamReceiverState","NoSource","setState","_c","element","setElement","_d","getConsumer","backConsumer","isConnectionEstablished","Connected","Reconnecting","indexOf","useEffect","session","consumer_1","unview","srcObject","view","limit","instance","undefined","useLocalConsumer","RemoteViewer","props","ref","createElement","className","muted","autoPlay","LocalViewer","setVer","storage","update","useCallback","connect","url","config","disconnect","createSession","myAudioStreams","myVideoStreams","audioStreams","videoStreams","publishers","consumers","consumerPairs","senders","sender","Array","from","values","peerId","name","StreamKinds","AUDIO","Disconnected","console","Error","Connecting","getPublisher","ownerId","cfg","createPublisher","preferredCodecs","simulcast","maxBitrate","contentHint","screen","owners","Date","getTime","backPublisher","size","createConsumer","getConsumerPair","audioName","videoName","createConsumerPair","backConsumerPair","Provider","value","children","StreamRemote","Promise","resolve","reject","res","playAudioMix","audioLevel","setAudioLevel","handler_1","level","streamName","BlueseaSessionContext","mixMinus","getMixMinusAudio","handler_4","concat","producer","handler_2","slotIndex","setSlot","handler_3","info","sourceId","split","consumer_2","setRes","containerSlot_1","key_1","devices","setDevices","setError","enumerateDevices","filter","d","active","gotStream_2","getDisplayMedia","forEach","JSON","stringify","publisherId","StreamSenderState","Created","setProducer","newProducer_1","onUpdateState_1","isMine","gotStream_1"],"mappings":"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"}